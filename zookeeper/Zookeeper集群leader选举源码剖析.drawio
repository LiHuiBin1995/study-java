<mxfile host="app.diagrams.net" modified="2021-10-09T09:48:05.014Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36" etag="bPIWNC8olp1vmieheNaY" version="15.4.3" type="github">
  <diagram id="SoEcYwhc6m7pzwqqew_2" name="第 1 页">
    <mxGraphModel dx="1473" dy="1556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="losnIFv3CeqP07pF8Fcl-114" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#FF0000;strokeWidth=2;curved=1;dashed=1;dashPattern=1 2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-35" target="losnIFv3CeqP07pF8Fcl-108">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2843" y="1080" />
              <mxPoint x="2680" y="1080" />
              <mxPoint x="2680" y="1355" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-1" target="ZCuFaapzUTEh5m-6mNR0-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-1" value="QuorumPeerMain.main服务端启动主类" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#B9E0A5;" parent="1" vertex="1">
          <mxGeometry x="50" y="90" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-2" target="ZCuFaapzUTEh5m-6mNR0-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-6" value="解析配置文件，&lt;br&gt;并将配置信息加载到内存" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ZCuFaapzUTEh5m-6mNR0-5" vertex="1" connectable="0">
          <mxGeometry x="-0.2467" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-2" value="main.initializeAndRun" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#FFFFFF;" parent="1" vertex="1">
          <mxGeometry x="50" y="190" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-4" target="ZCuFaapzUTEh5m-6mNR0-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-9" value="开始并清理快照文件任务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="ZCuFaapzUTEh5m-6mNR0-8" vertex="1" connectable="0">
          <mxGeometry x="-0.1563" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-4" value="config.parse(args[0]);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="300" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-7" target="ZCuFaapzUTEh5m-6mNR0-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-14" value="集群启动核心流程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF0000;fontStyle=1" parent="ZCuFaapzUTEh5m-6mNR0-11" vertex="1" connectable="0">
          <mxGeometry x="-0.2615" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-7" target="ZCuFaapzUTEh5m-6mNR0-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-15" value="单机启动&lt;br&gt;核心流程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF0000;fontStyle=1" parent="ZCuFaapzUTEh5m-6mNR0-13" vertex="1" connectable="0">
          <mxGeometry x="0.1463" y="-1" relative="1" as="geometry">
            <mxPoint x="7" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-7" value="purgeMgr.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="410" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-17" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;strokeWidth=2;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="230" y="550" />
              <mxPoint x="230" y="120" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-19" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-20" value="初始化服务端连接对象&lt;br&gt;ZK默认使用NIO&lt;br&gt;官方推荐使用Netty" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-19" vertex="1" connectable="0">
          <mxGeometry x="0.3101" y="-7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-30" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-29" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="320" y="550" />
              <mxPoint x="320" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-31" value="获取本服务节点对象" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-30" vertex="1" connectable="0">
          <mxGeometry x="0.1461" y="-5" relative="1" as="geometry">
            <mxPoint x="35" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-33" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-34" value="设置选举类型&lt;br&gt;默认为3" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-33" vertex="1" connectable="0">
          <mxGeometry x="0.1197" y="-6" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-36" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-35" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="380" y="550" />
              <mxPoint x="380" y="450" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-37" value="初始化内存&lt;br&gt;数据库对象" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-36" vertex="1" connectable="0">
          <mxGeometry x="0.1899" y="-5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-39" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-40" value="将上面创建的初始服务&lt;br&gt;连接对象放入到本服务节点对象中" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-39" vertex="1" connectable="0">
          <mxGeometry x="0.1642" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-42" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-10" target="ZCuFaapzUTEh5m-6mNR0-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-43" value="启动服务节点" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-42" vertex="1" connectable="0">
          <mxGeometry x="0.0371" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-10" value="runFromConfig(config);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#99FF99;html=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="530" width="130" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-12" value="ZooKeeperServerMain.main(args);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#99FF99;html=1;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="-240" y="410" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-16" value="ManagedUtil.registerLog4jMBeans();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="100" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-23" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;fontColor=#000000;strokeWidth=2;dashed=1;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-18" target="ZCuFaapzUTEh5m-6mNR0-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-25" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-18" target="ZCuFaapzUTEh5m-6mNR0-24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-28" value="初始化Netty线程组&lt;br&gt;bossGroup和WorkerGroup" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-25" vertex="1" connectable="0">
          <mxGeometry x="0.1819" y="1" relative="1" as="geometry">
            <mxPoint x="-22" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-18" value="cnxnFactory = ServerCnxnFactory.createFactory();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="200" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-21" value="如果要使用Netty通信框架需要加入启动参数&lt;br&gt;-Dzookeeper.server.CnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory" style="shape=note;strokeWidth=2;fontSize=14;size=20;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#666600;rounded=0;verticalAlign=middle;" parent="1" vertex="1">
          <mxGeometry x="600" y="140" width="569" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-24" value="NettyServerCnxnFactory()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="880" y="200" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-29" value="quorumPeer =QuorumPeerMain.getQuorumPeer();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="530" y="290" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-32" value="quorumPeer.setElectionType(config.getElectionAlg());" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="530" y="350" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-35" value="quorumPeer.setZKDatabase(new ZKDatabase(quorumPeer.getTxnFactory()));" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" parent="1" vertex="1">
          <mxGeometry x="530" y="430" width="290" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-38" value="quorumPeer.setCnxnFactory(cnxnFactory);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" parent="1" vertex="1">
          <mxGeometry x="530" y="530" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-45" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-41" target="ZCuFaapzUTEh5m-6mNR0-44" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="840" y="680" />
              <mxPoint x="840" y="475" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-46" value="加载文件数据到内存" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-45" vertex="1" connectable="0">
          <mxGeometry x="-0.1107" y="-2" relative="1" as="geometry">
            <mxPoint x="8" y="23" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-48" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" parent="1" source="ZCuFaapzUTEh5m-6mNR0-41" target="ZCuFaapzUTEh5m-6mNR0-47" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="930" y="680" />
              <mxPoint x="930" y="565" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-49" value="启动Netty服务" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" parent="ZCuFaapzUTEh5m-6mNR0-48" vertex="1" connectable="0">
          <mxGeometry x="0.1286" y="7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;curved=1;" edge="1" parent="1" source="ZCuFaapzUTEh5m-6mNR0-41" target="losnIFv3CeqP07pF8Fcl-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-8" value="启动内嵌Jetty服务，默认8080端口&lt;br&gt;用来查看服务端状态信息" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-7">
          <mxGeometry x="0.3201" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-10" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="ZCuFaapzUTEh5m-6mNR0-41" target="losnIFv3CeqP07pF8Fcl-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-11" value="初始化集群选举leader&lt;br&gt;相关对象数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-10">
          <mxGeometry x="0.0467" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-88" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#FF3333;strokeWidth=2;" edge="1" parent="1" source="ZCuFaapzUTEh5m-6mNR0-41" target="losnIFv3CeqP07pF8Fcl-87">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-89" value="启动集群选举leader线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-88">
          <mxGeometry x="0.0479" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-41" value="quorumPeer.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" parent="1" vertex="1">
          <mxGeometry x="530" y="660" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-44" value="loadDataBase();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" parent="1" vertex="1">
          <mxGeometry x="1100" y="460" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="ZCuFaapzUTEh5m-6mNR0-47" target="losnIFv3CeqP07pF8Fcl-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ZCuFaapzUTEh5m-6mNR0-47" value="startServerCnxnFactory();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" parent="1" vertex="1">
          <mxGeometry x="1091" y="550" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-1" target="losnIFv3CeqP07pF8Fcl-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-5" value="绑定端口启动" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-4">
          <mxGeometry x="-0.1751" relative="1" as="geometry">
            <mxPoint x="5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-1" value="NettyServerCnxnFactory.start()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1321" y="550" width="179" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-3" value="bootstrap.bind(localAddress)" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1610" y="550" width="179" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-6" value="adminServer.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1091" y="665" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-13" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-9" target="losnIFv3CeqP07pF8Fcl-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-9" value="startLeaderElection();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="1091" y="770" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-15" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-12" target="losnIFv3CeqP07pF8Fcl-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-16" value="初始化选举数据管理器" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-15">
          <mxGeometry x="0.1341" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-18" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-12" target="losnIFv3CeqP07pF8Fcl-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-19" value="启动选举监听" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-18">
          <mxGeometry x="0.1241" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-21" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-12" target="losnIFv3CeqP07pF8Fcl-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-22" value="启动快速选举算法相关线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-21">
          <mxGeometry x="0.0867" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-12" value="createElectionAlgorithm(electionType);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1360" y="770" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-14" value="createCnxnManager();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1710" y="660" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-163" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;curved=1;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-17" target="losnIFv3CeqP07pF8Fcl-162">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-164" value="QuorumCnxManager.Listener" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-163">
          <mxGeometry x="-0.2158" relative="1" as="geometry">
            <mxPoint x="27" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-17" value="listener.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1739.5" y="770" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-24" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-20" target="losnIFv3CeqP07pF8Fcl-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-20" value="FastLeaderElection fle = new FastLeaderElection(this, qcm);&#xa;fle.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1730" y="860" width="200.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-23" target="losnIFv3CeqP07pF8Fcl-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-27" value="运行发送选票线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-26">
          <mxGeometry x="0.1281" y="-2" relative="1" as="geometry">
            <mxPoint y="16" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-29" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-23" target="losnIFv3CeqP07pF8Fcl-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-30" value="运行接收选票线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-29">
          <mxGeometry x="0.1087" y="4" relative="1" as="geometry">
            <mxPoint y="-13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-23" value="messenger.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2020" y="875" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-32" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-25" target="losnIFv3CeqP07pF8Fcl-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-25" value="this.wsThread.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2370" y="820" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-28" target="losnIFv3CeqP07pF8Fcl-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-28" value="this.wsThread.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2370" y="930" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-36" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-31" target="losnIFv3CeqP07pF8Fcl-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-37" value="从应用层发送队列&lt;br&gt;(LinkedBlockingQueue)里&lt;br&gt;取选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-36">
          <mxGeometry x="0.0909" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-31" value="WorkerSender.run()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2530" y="820" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-39" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-33" target="losnIFv3CeqP07pF8Fcl-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-42" value="从接收层接收队列&lt;br&gt;(LinkedBlockingQueue)里&lt;br&gt;取出选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-39">
          <mxGeometry x="-0.1601" y="-3" relative="1" as="geometry">
            <mxPoint x="-7" y="12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-33" value="WorkerReceiver.run()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2530" y="930" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-44" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-35" target="losnIFv3CeqP07pF8Fcl-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-45" value="处理取出的选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-44">
          <mxGeometry x="0.2722" y="1" relative="1" as="geometry">
            <mxPoint x="-1" y="-11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-35" value="sendqueue.poll(3000, TimeUnit.MILLISECONDS);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="2770" y="710" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-41" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-38" target="losnIFv3CeqP07pF8Fcl-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-38" value="manager.pollRecvQueue(3000, TimeUnit.MILLISECONDS);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="2830" y="1020" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-73" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-40" target="losnIFv3CeqP07pF8Fcl-72">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-86" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#FF3333;strokeWidth=2;entryX=0;entryY=0.75;entryDx=0;entryDy=0;dashed=1;dashPattern=1 2;" edge="1" parent="1" target="losnIFv3CeqP07pF8Fcl-51">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3165" y="1020" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="3165" y="910" />
              <mxPoint x="3590" y="910" />
              <mxPoint x="3590" y="694" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-214" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;dashed=1;dashPattern=1 2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-40" target="losnIFv3CeqP07pF8Fcl-204">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3165" y="890" />
              <mxPoint x="5460" y="890" />
              <mxPoint x="5460" y="275" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-40" value="recvQueue.poll(timeout, unit);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="3070" y="1020" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-47" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-43" target="losnIFv3CeqP07pF8Fcl-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-48" value="发送选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-47">
          <mxGeometry x="-0.1643" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-43" value="process(m);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2875" y="800" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-50" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-46" target="losnIFv3CeqP07pF8Fcl-49">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-46" value="manager.toSend(m.sid, requestBuffer);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3088" y="800" width="220" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-52" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-49" target="losnIFv3CeqP07pF8Fcl-51">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-53" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-52">
          <mxGeometry x="-0.1723" y="1" relative="1" as="geometry">
            <mxPoint x="24" y="19" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-56" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#FF6666;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-49" target="losnIFv3CeqP07pF8Fcl-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-57" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;fontStyle=1" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-56">
          <mxGeometry x="-0.1111" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-49" value="this.mySid == sid ？" style="rhombus;whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;html=1;" vertex="1" parent="1">
          <mxGeometry x="3400" y="782.5" width="160" height="65" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-59" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-55" target="losnIFv3CeqP07pF8Fcl-58">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-55" value="ArrayBlockingQueue&lt;ByteBuffer&gt; bq = new ArrayBlockingQueue&lt;ByteBuffer&gt;(&#xa;   SEND_CAPACITY);&#xa;ArrayBlockingQueue&lt;ByteBuffer&gt; oldq = queueSendMap.putIfAbsent(sid, bq);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3870" y="930" width="440" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-67" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-58" target="losnIFv3CeqP07pF8Fcl-66">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-70" value="与对方sid机器建立连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-67">
          <mxGeometry x="-0.1342" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-66" value="connectOne(sid);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="4035" y="1260" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-68" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="3990" y="1050" width="200" height="140" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-58" value="放入传输层待发送队列中" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;verticalAlign=top;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-68">
          <mxGeometry width="200" height="140" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-60" value="addToSendQueue(bq, b);" style="rounded=0;whiteSpace=wrap;fontColor=#000000;fillColor=#B3FF66;verticalAlign=middle;html=1;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-68">
          <mxGeometry x="25" y="30" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-61" value="queue.add(buffer);" style="rounded=0;whiteSpace=wrap;fontColor=#000000;fillColor=#B3FF66;verticalAlign=middle;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-68">
          <mxGeometry x="25" y="90" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-62" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;strokeWidth=2;" edge="1" parent="losnIFv3CeqP07pF8Fcl-68" source="losnIFv3CeqP07pF8Fcl-60" target="losnIFv3CeqP07pF8Fcl-61">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-69" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="3700" y="585" width="340" height="145" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-51" value="如果选票接收机器是自己，就将选票放入到自己的接收队列中&lt;br&gt;&lt;br&gt;" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FF6666;verticalAlign=top;html=1;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-69">
          <mxGeometry width="340" height="145" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-63" value="addToRecvQueue(new Message(b.duplicate(), sid));" style="rounded=0;whiteSpace=wrap;fontColor=#000000;fillColor=#B3FF66;verticalAlign=middle;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-69">
          <mxGeometry x="20" y="35" width="300" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-64" value="recvQueue.add(msg);" style="rounded=0;whiteSpace=wrap;fontColor=#000000;fillColor=#B3FF66;verticalAlign=middle;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-69">
          <mxGeometry x="95" y="95" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-65" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="losnIFv3CeqP07pF8Fcl-69" source="losnIFv3CeqP07pF8Fcl-63" target="losnIFv3CeqP07pF8Fcl-64">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-75" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-72" target="losnIFv3CeqP07pF8Fcl-74">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-76" value="是&lt;br&gt;本机还处于选举状态" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-75">
          <mxGeometry x="0.1" y="11" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-81" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-72" target="losnIFv3CeqP07pF8Fcl-80">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-82" value="否&lt;br&gt;本机不是选举状态&lt;br&gt;已经选出了leader" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-81">
          <mxGeometry x="0.1288" y="-7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-72" value="if(self.getPeerState() == &#xa;QuorumPeer.ServerState.LOOKING) ？" style="rhombus;whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2972.5" y="1089" width="385" height="80" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-78" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-74" target="losnIFv3CeqP07pF8Fcl-77">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-79" value="if((ackstate == QuorumPeer.ServerState.LOOKING)&lt;br&gt;        &amp;amp;&amp;amp; (n.electionEpoch &amp;lt; logicalclock.get()))&lt;br&gt;如果发送选票方处于选举状态并且发起选举周期小于自己，&lt;br&gt;则把自己PK出来的选票回发给发送选票方" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-78">
          <mxGeometry x="-0.1892" y="7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-74" value="放入应用层接收队列&#xa;recvqueue.offer(n);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" vertex="1" parent="1">
          <mxGeometry x="2852.5" y="1230" width="117.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-77" value="sendqueue.offer(notmsg);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2922.5" y="1400" width="147.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-84" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-80" target="losnIFv3CeqP07pF8Fcl-83">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-85" value="if(ackstate == QuorumPeer.ServerState.LOOKING)&lt;br&gt;如果发送选票方式选举状态，则把本机认为的leader选票&lt;br&gt;回发给发送选票方" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF3333;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-84">
          <mxGeometry x="-0.175" y="7" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-80" value="Vote current = self.getCurrentVote();&#xa;本机当前选票，这个选票一般是leader" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3320" y="1225" width="147.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-252" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#FF0000;strokeWidth=2;dashed=1;dashPattern=1 2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-83">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3080" y="1700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-253" value="对方收到的选票是LEADING&lt;br&gt;执行LEADING逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-252">
          <mxGeometry x="-0.0941" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-83" value="sendqueue.offer(notmsg);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3390" y="1400" width="147.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-91" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-87" target="losnIFv3CeqP07pF8Fcl-90">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-87" value="super.start();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="940" y="1339.5" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-93" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-90" target="losnIFv3CeqP07pF8Fcl-92">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-94" value="while死循环，&lt;br&gt;根据当前节点状态&lt;br&gt;做出对应业务处理" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-93">
          <mxGeometry x="-0.1715" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-90" value="QuorumPeer.run()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#33FF33;" vertex="1" parent="1">
          <mxGeometry x="1139" y="1339.5" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-96" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-92" target="losnIFv3CeqP07pF8Fcl-95">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-97" value="LOOKING&lt;br&gt;选举状态" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF0000;fontStyle=1" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-96">
          <mxGeometry x="-0.3071" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-255" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;curved=1;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-92" target="losnIFv3CeqP07pF8Fcl-254">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-256" value="&lt;span style=&quot;background-color: rgb(248 , 249 , 250)&quot;&gt;FOLLOWING&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-255">
          <mxGeometry x="-0.3329" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-92" value="switch(getPeerState())&#xa;节点自己的状态" style="rhombus;whiteSpace=wrap;fontColor=#000000;fillColor=#FFFFFF;verticalAlign=middle;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1410" y="1310" width="190" height="89" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-99" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#FF0000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-95" target="losnIFv3CeqP07pF8Fcl-98">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-100" value="选举周期加1" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-99">
          <mxGeometry x="0.0819" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-102" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-95" target="losnIFv3CeqP07pF8Fcl-101">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-103" value="初始化选票（自己）" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#FF6666;fontStyle=1;fontSize=12;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-102">
          <mxGeometry x="0.1258" relative="1" as="geometry">
            <mxPoint x="25" y="-4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-106" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=12;fontColor=#FF6666;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-95" target="losnIFv3CeqP07pF8Fcl-104">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-107" value="发送选票选自己" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF6666;fontStyle=1" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-106">
          <mxGeometry x="0.0773" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-116" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#FF0000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-95" target="losnIFv3CeqP07pF8Fcl-115">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-117" value="while ((self.getPeerState() == ServerState.LOOKING) &amp;&amp;&#xa;        (!stop))&#xa;当节点是选举状态会不断地从应用层接收队列里拿选票做选举" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF0000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-116">
          <mxGeometry x="0.0542" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-95" value="makeLEStrategy().lookForLeader()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="1700" y="1339.5" width="200.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-98" value="logicalclock.incrementAndGet();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2060" y="1059" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-101" value="updateProposal(getInitId(), getInitLastLoggedZxid(), getPeerEpoch());" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2150" y="1140" width="390" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-109" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#FF6666;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-104" target="losnIFv3CeqP07pF8Fcl-108">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-110" value="给其他所有参与投票的节点&lt;br&gt;发送选票到应用层发送队列" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-109">
          <mxGeometry x="-0.1429" y="1" relative="1" as="geometry">
            <mxPoint x="7" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-112" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-104" target="losnIFv3CeqP07pF8Fcl-111">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-113" value="选票里的最大zxid是从内存树中取的&lt;br&gt;也就是说只有被commit到内存中的数&lt;br&gt;据才会真正有效" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF0000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-112">
          <mxGeometry x="0.0609" y="1" relative="1" as="geometry">
            <mxPoint x="15" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-104" value="sendNotifications();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2110" y="1334.5" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-108" value="sendqueue.offer(notmsg);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" vertex="1" parent="1">
          <mxGeometry x="2410" y="1334.5" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-111" value="getInitLastLoggedZxid()" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2420" y="1235" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-118" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#FF0000;strokeWidth=2;dashed=1;dashPattern=1 2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-115" target="losnIFv3CeqP07pF8Fcl-74">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2700" y="1545" />
              <mxPoint x="2700" y="1250" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-120" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-115" target="losnIFv3CeqP07pF8Fcl-119">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-115" value="Notification n = recvqueue.poll(notTimeout,&#xa;        TimeUnit.MILLISECONDS);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" vertex="1" parent="1">
          <mxGeometry x="2100" y="1520" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-122" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-119" target="losnIFv3CeqP07pF8Fcl-121">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-123" value="是" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-122">
          <mxGeometry x="-0.2546" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-130" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-119" target="losnIFv3CeqP07pF8Fcl-129">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-131" value="否" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-130">
          <mxGeometry x="-0.5509" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-119" value="n == null" style="rhombus;whiteSpace=wrap;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#FFFFFF;verticalAlign=middle;html=1;" vertex="1" parent="1">
          <mxGeometry x="2150" y="1630" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-125" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-121" target="losnIFv3CeqP07pF8Fcl-124">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-121" value="manager.connectAll();&#xa;第一次启动时肯定是没有选票的，这时会跟需要发送选票的机器建立连接" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" vertex="1" parent="1">
          <mxGeometry x="1930" y="1625" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-127" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-124" target="losnIFv3CeqP07pF8Fcl-126">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-128" value="建立socket连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-127">
          <mxGeometry x="-0.1527" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-124" value="QuorumConnectionReqThread.run()" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1905" y="1740" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-126" value="sock.connect(electionAddr, cnxTO);" style="whiteSpace=wrap;strokeWidth=2;fillColor=#7EA6E0;" vertex="1" parent="1">
          <mxGeometry x="1905" y="1840" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-133" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-129" target="losnIFv3CeqP07pF8Fcl-132">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-134" value="LOOKING&lt;br&gt;选举主线逻辑" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF0000;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-133">
          <mxGeometry x="-0.2454" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-136" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF0000;strokeWidth=2;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-132" target="losnIFv3CeqP07pF8Fcl-135">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-137" value="n.electionEpoch &amp;gt; logicalclock.get()&lt;br&gt;接收的选票选举周期大于自己的选举周期，&lt;br&gt;这种情况可能是自己后启动加入集群选举，&lt;br&gt;或者网络中断恢复后加入集群，&lt;br&gt;其他机器已经选举过好几轮了，所以需要跟&lt;br&gt;新自己的选举周期到最新" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-136">
          <mxGeometry x="0.5106" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-248" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-129" target="losnIFv3CeqP07pF8Fcl-247">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3530" y="1760" />
              <mxPoint x="3530" y="3105" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-251" value="FOLLOWING&#xa;LEADING&#xa;&#xa;这种状态一般是已经选出leader的集群&#xa;有新机器加入了，新机器处于LOOKING状态&#xa;会先投票给自己，其他机器收到后会回发已经&#xa;选出的集群leader选票给新机器，这个选票的&#xa;发送方状态就是FOLLOWING或LEADING" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF0000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-248">
          <mxGeometry x="-0.661" y="-1" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-129" value="n.state&lt;br&gt;判断选票状态，这个状态是发送选票方的状态" style="rhombus;whiteSpace=wrap;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#FFFFFF;verticalAlign=middle;html=1;" vertex="1" parent="1">
          <mxGeometry x="2520" y="1720" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-139" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-132" target="losnIFv3CeqP07pF8Fcl-138">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2610" y="1960" />
              <mxPoint x="2610" y="1960" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-140" value="n.electionEpoch &amp;lt; logicalclock.get()&lt;br&gt;接收的选票选举周期小于自己，意味着发选票&lt;br&gt;的机器刚加入到集群选举，发起投他自己的选&lt;br&gt;票，这种选票一般都要废弃掉。" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-139">
          <mxGeometry x="-0.328" relative="1" as="geometry">
            <mxPoint y="12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-142" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-132" target="losnIFv3CeqP07pF8Fcl-141">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-143" value="n.electionEpoch == logicalclock.get()&lt;br&gt;接收选票的选举周期等于自己，意味着大家一直在参与选举，&lt;br&gt;那么在选举PK时需要拿收到的选票和我之前投的选票做对比" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-142">
          <mxGeometry x="0.6854" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-132" value="" style="rhombus;whiteSpace=wrap;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#FFFFFF;verticalAlign=middle;html=1;" vertex="1" parent="1">
          <mxGeometry x="2565" y="1880" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-145" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-135" target="losnIFv3CeqP07pF8Fcl-144">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-146" value="选票PK&lt;br&gt;因为自己选举周期落后了，可能是刚加入集群选举，&lt;br&gt;所以是拿收到的选票跟投给自己的选票做PK" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-145">
          <mxGeometry x="-0.2311" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-135" value="// 更新自己的选举周期&lt;br&gt;logicalclock.set(n.electionEpoch);&lt;br&gt;// 清空之前的选票&lt;br&gt;recvset.clear();" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2190" y="2000" width="190" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-138" value="break；" style="whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2555" y="2025" width="110" height="45" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-157" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-141" target="losnIFv3CeqP07pF8Fcl-156">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-141" value="totalOrderPredicate(n.leader, n.zxid, n.peerEpoch,&lt;br&gt;        proposedLeader, proposedZxid, proposedEpoch)" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" vertex="1" parent="1">
          <mxGeometry x="2880" y="2005" width="270" height="75" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-148" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-144" target="losnIFv3CeqP07pF8Fcl-147">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-149" value="具体选举PK逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-148">
          <mxGeometry x="-0.2909" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-144" value="totalOrderPredicate(n.leader, n.zxid, n.peerEpoch,&lt;br&gt;        getInitId(), getInitLastLoggedZxid(), getPeerEpoch())" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;html=1;" vertex="1" parent="1">
          <mxGeometry x="2146.25" y="2160" width="277.5" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-151" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-147" target="losnIFv3CeqP07pF8Fcl-150">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-152" value="true&lt;br&gt;接收到的选票胜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-151">
          <mxGeometry x="0.3571" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-154" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-147" target="losnIFv3CeqP07pF8Fcl-153">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-155" value="false&lt;br&gt;自己胜" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-154">
          <mxGeometry x="0.0668" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-147" value="((newEpoch &amp;gt; curEpoch) ||&lt;br&gt;        ((newEpoch == curEpoch) &amp;amp;&amp;amp;&lt;br&gt;        ((newZxid &amp;gt; curZxid) || ((newZxid == curZxid) &amp;amp;&amp;amp; (newId &amp;gt; curId)))))" style="rhombus;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;html=1;" vertex="1" parent="1">
          <mxGeometry x="2121.88" y="2310" width="326.25" height="80" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-159" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-150" target="losnIFv3CeqP07pF8Fcl-158">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-150" value="updateProposal(n.leader, n.zxid, n.peerEpoch);" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1871.25" y="2480" width="267.5" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-160" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-153" target="losnIFv3CeqP07pF8Fcl-158">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2484" y="2660" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-153" value="updateProposal(getInitId(),&#xa;        getInitLastLoggedZxid(),&#xa;        getPeerEpoch());" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2370" y="2470" width="227.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-161" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-156" target="losnIFv3CeqP07pF8Fcl-158">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-156" value="updateProposal(n.leader, n.zxid, n.peerEpoch);" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" vertex="1" parent="1">
          <mxGeometry x="2887.5" y="2470" width="255" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-217" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-158" target="losnIFv3CeqP07pF8Fcl-216">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-218" value="给所有其他参与投票的节点&lt;br&gt;发送选票到应用层发送队列" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-217">
          <mxGeometry x="-0.1512" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-220" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-158" target="losnIFv3CeqP07pF8Fcl-219">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-221" value="将接收到的选票放入选票箱" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-220">
          <mxGeometry x="-0.1672" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-158" value="sendNotifications();&#xa;发送选票" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2378.75" y="2580" width="210" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-174" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-162" target="losnIFv3CeqP07pF8Fcl-165">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-175" value="&lt;font color=&quot;#ff0000&quot;&gt;在选举端口监听连接&lt;br&gt;选举使用普通的socket通信(BIO)&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-174">
          <mxGeometry x="-0.0878" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-177" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#FF0000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-162" target="losnIFv3CeqP07pF8Fcl-176">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-178" value="接收连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-177">
          <mxGeometry x="0.1663" y="5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-162" value="listener.run();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2160" y="480" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-173" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="2500" y="200" width="215" height="220" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-165" value="" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFCCFF;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-173">
          <mxGeometry width="215" height="220" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-166" value="ss = new ServerSocket();" style="rounded=0;whiteSpace=wrap;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#F8CECC;align=center;verticalAlign=middle;html=1;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-173">
          <mxGeometry x="35" y="20" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-167" value="ss.bind(addr);" style="rounded=0;whiteSpace=wrap;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#F8CECC;align=center;verticalAlign=middle;html=1;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-173">
          <mxGeometry x="35" y="80" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-168" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="losnIFv3CeqP07pF8Fcl-173" source="losnIFv3CeqP07pF8Fcl-166" target="losnIFv3CeqP07pF8Fcl-167">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-172" value="" style="group" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-173">
          <mxGeometry x="25" y="140" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-169" value="while(!shutdown)" style="shape=umlFrame;whiteSpace=wrap;html=1;rounded=0;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#FFFFFF;gradientColor=#ffffff;verticalAlign=middle;width=110;height=20;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-172">
          <mxGeometry width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-170" value="client = ss.accept();" style="rounded=0;whiteSpace=wrap;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#F8CECC;align=center;verticalAlign=middle;html=1;" vertex="1" parent="losnIFv3CeqP07pF8Fcl-172">
          <mxGeometry x="13.75" y="30" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-171" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="losnIFv3CeqP07pF8Fcl-173" source="losnIFv3CeqP07pF8Fcl-167" target="losnIFv3CeqP07pF8Fcl-169">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-180" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-176" target="losnIFv3CeqP07pF8Fcl-179">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-181" value="处理连接信息" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-180">
          <mxGeometry x="-0.1805" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-176" value="receiveConnection(client);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" vertex="1" parent="1">
          <mxGeometry x="2540" y="500" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-183" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-179" target="losnIFv3CeqP07pF8Fcl-182">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-184" value="读取发送选票的机器id" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-183">
          <mxGeometry x="0.1833" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-186" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-179" target="losnIFv3CeqP07pF8Fcl-185">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-179" value="handleConnection(sock, din);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2850" y="500" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-182" value="protocolVersion = din.readLong();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3120" y="240" width="207.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-188" value="" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-185" target="losnIFv3CeqP07pF8Fcl-187">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-189" value="if (sid &lt; self.getId())" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#FF0000;fontStyle=1" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-188">
          <mxGeometry x="0.0766" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-191" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#FF0000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-185" target="losnIFv3CeqP07pF8Fcl-190">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-192" value="else if (sid == self.getId())" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;html=1;fontStyle=1" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-191">
          <mxGeometry x="0.1612" y="-11" relative="1" as="geometry">
            <mxPoint x="24" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-194" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-185" target="losnIFv3CeqP07pF8Fcl-193">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-195" value="&lt;span style=&quot;font-weight: 700&quot;&gt;else if (sid &amp;gt; self.getId())&lt;br&gt;开启接收选票线程&lt;br&gt;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-194">
          <mxGeometry x="0.446" y="-5" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-185" value="" style="rhombus;whiteSpace=wrap;html=1;rounded=0;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3373" y="340" width="82.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-187" value="closeSocket(sock); // 如果发送选票的机器id小于当前机器，则关闭连接，为了防止机器之间相互重复建立socket连接（双向的），zk不允许id小的机器连接id大的机器&#xa;&#xa;connectOne(sid, electionAddr); // 当前机器主动发起socket连接到发送选票的id较小的机器" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="3715.5" y="-30" width="280" height="110" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-190" value="一般不可能发生，如果发生可能是bug" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="3805.5" y="160" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-197" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-193" target="losnIFv3CeqP07pF8Fcl-196">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-198" value="在接收到选票的时候就给发选票机器建立一个&lt;br&gt;选票发送器线程，供将来发选票使用，并启动发送线程" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-197">
          <mxGeometry x="-0.2239" y="4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-200" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-193" target="losnIFv3CeqP07pF8Fcl-199">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-201" value="RecvWorker" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-200">
          <mxGeometry x="0.1521" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-193" value="RecvWorker rw = new RecvWorker(sock, din, sid, sw);&#xa;rw.start();" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="3970" y="240" width="300" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-208" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-196" target="losnIFv3CeqP07pF8Fcl-207">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-209" value="SendWorker" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-208">
          <mxGeometry x="-0.2079" y="4" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-196" value="// 给发送给选票sid这台机器创建一个选票发送器&#xa;SendWorker sw = new SendWorker(sock, sid);&#xa;&#xa;// 将选票发送器与sid对应放入map中&#xa;senderWorkerMap.put(sid, sw);&#xa;&#xa;// 给发送选票sid机器初始化一个发送选票队列放入map中&#xa;queueSendMap.putIfAbsent(sid,&#xa;        new ArrayBlockingQueue&lt;ByteBuffer&gt;(SEND_CAPACITY));&#xa;&#xa;// 启动选票发送器线程&#xa;sw.start();" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="4070" y="392.5" width="340" height="177.5" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-203" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-199" target="losnIFv3CeqP07pF8Fcl-202">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-199" value="rw.run();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="4400" y="260" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-205" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-202" target="losnIFv3CeqP07pF8Fcl-204">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-206" value="最终将接收到的选票丢入&lt;br&gt;recvQueue中异步处理" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-205">
          <mxGeometry x="-0.0709" y="6" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-202" value="addToRecvQueue(new Message(message.duplicate(), sid));" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="4580" y="250" width="208" height="60" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-204" value="recvQueue.add(msg);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="4990" y="260" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-211" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-207" target="losnIFv3CeqP07pF8Fcl-210">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-212" value="while循环发送选票" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-211">
          <mxGeometry x="-0.216" y="3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-207" value="sw.run();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF3333;" vertex="1" parent="1">
          <mxGeometry x="4580" y="460" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-215" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=1 2;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-210" target="losnIFv3CeqP07pF8Fcl-55">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5330" y="470" />
              <mxPoint x="5330" y="965" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-210" value="// 取出发送选票队列&#xa;ArrayBlockingQueue&lt;ByteBuffer&gt; bq = queueSendMap.get(sid);&#xa;&#xa;// 发送选票&#xa;send(b);" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=left;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="4840" y="430" width="360" height="80" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-216" value="sendqueue.offer(notmsg);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;" vertex="1" parent="1">
          <mxGeometry x="2795" y="2575" width="200" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-223" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-219" target="losnIFv3CeqP07pF8Fcl-235">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2483.75" y="2840" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-224" value="过半选举leader逻辑" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-223">
          <mxGeometry x="-0.2653" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-219" value="recvset.put(n.sid, new Vote(n.leader, n.zxid, n.electionEpoch, n.peerEpoch));" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2378.75" y="2700" width="210" height="70" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-226" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;dashed=1;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-235" target="losnIFv3CeqP07pF8Fcl-225">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2603.75" y="2870" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-227" value="for循环选票箱里收到的选票&lt;br&gt;与本机投的leader选票做对比&lt;br&gt;如果相等，将投票机器sid加入voteSet" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-226">
          <mxGeometry x="0.0794" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-229" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-225" target="losnIFv3CeqP07pF8Fcl-228">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-225" value="if (vote.equals(entry.getValue())) {&#xa;    voteSet.addAck(entry.getKey());&#xa;}" style="whiteSpace=wrap;align=left;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2900" y="2700" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-231" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-228" target="losnIFv3CeqP07pF8Fcl-230">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-228" value="voteSet.hasAllQuorums();" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2915" y="2800" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-233" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-230" target="losnIFv3CeqP07pF8Fcl-232">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-234" value="QuorumMaj.containsQuorum()&lt;br&gt;投票机器超过半数" style="edgeLabel;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;html=1;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-233">
          <mxGeometry x="-0.323" y="-1" relative="1" as="geometry">
            <mxPoint x="1" y="13" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-230" value="if (!qvAckset.getQuorumVerifier().containsQuorum(qvAckset.getAckset()))" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2915" y="2900" width="405" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-232" value="(ackSet.size() &gt; half)" style="whiteSpace=wrap;align=center;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="3055" y="3020" width="125" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-238" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-235" target="losnIFv3CeqP07pF8Fcl-237">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-241" value="当上一步选出leader之后，再看一下是否有新的选票加入，&lt;br&gt;如果有，还需要做一下选票PK，如果新选票获胜，则需要重新选举" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-238">
          <mxGeometry x="0.7163" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-240" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-235" target="losnIFv3CeqP07pF8Fcl-239">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-242" value="如果本机投的leader和本机sid一样，&lt;br&gt;则自己就是leader，否则就是follower或Observer" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-240">
          <mxGeometry x="0.7612" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-235" value="if (termPredicate(recvset,&lt;br&gt;new Vote(proposedLeader, proposedZxid,&lt;br&gt;logicalclock.get(), proposedEpoch))) ?" style="rhombus;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;" vertex="1" parent="1">
          <mxGeometry x="2290.63" y="2833" width="386.25" height="90" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-237" value="while((n = recvqueue.poll(finalizeWait,&lt;br&gt;        TimeUnit.MILLISECONDS)) != null){&lt;br&gt;&amp;nbsp; if(totalOrderPredicate(n.leader, n.zxid, n.peerEpoch,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;proposedLeader, proposedZxid, proposedEpoch)){&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;recvqueue.put(n);&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;break;&lt;br&gt;&amp;nbsp; &amp;nbsp;}&lt;br&gt;}" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="2120" y="3090" width="290" height="130" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-244" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=12;fontColor=#000000;strokeWidth=2;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-239" target="losnIFv3CeqP07pF8Fcl-243">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-245" value="返回选出的leader并&lt;br&gt;设置到自己节点的&lt;br&gt;currentVote属性里" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-244">
          <mxGeometry x="-0.2886" y="-2" relative="1" as="geometry">
            <mxPoint x="2" y="12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-239" value="self.setPeerState((proposedLeader == self.getId()) ?&lt;br&gt;        ServerState.LEADING: learningState());" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;html=1;" vertex="1" parent="1">
          <mxGeometry x="2630" y="3090" width="310" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-243" value="return endVote;" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;align=center;html=1;" vertex="1" parent="1">
          <mxGeometry x="2730" y="3210" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-247" value="设置本机状态&lt;br&gt;self.setPeerState((proposedLeader == self.getId()) ?&lt;br&gt;        ServerState.LEADING: learningState());" style="whiteSpace=wrap;strokeWidth=2;fillColor=#FF6666;html=1;" vertex="1" parent="1">
          <mxGeometry x="3132.5" y="3080" width="310" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-249" value="逻辑类似" style="html=1;shadow=0;dashed=0;align=center;verticalAlign=middle;shape=mxgraph.arrows2.twoWayArrow;dy=0.65;dx=22;fontSize=12;fontColor=#000000;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="2940" y="3085" width="192.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-258" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-254" target="losnIFv3CeqP07pF8Fcl-257">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-260" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#FF0000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-254" target="losnIFv3CeqP07pF8Fcl-259">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-261" value="与leader建立连接&lt;br&gt;并接收leader数据同步" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-260">
          <mxGeometry x="0.2324" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-254" value="makeFollower(logFactory)" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1370" y="1480" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-257" value="new Follower(this, new &lt;font color=&quot;#ff0000&quot;&gt;FollowerZooKeeperServer&lt;/font&gt;(logFactory, this, this.zkDb));" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;html=1;" vertex="1" parent="1">
          <mxGeometry x="1574" y="1457.5" width="215" height="75" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-263" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-259" target="losnIFv3CeqP07pF8Fcl-262">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-264" value="获取leader server" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-263">
          <mxGeometry x="-0.1844" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-259" value="follower.followLeader();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1370" y="1590" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-266" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-262" target="losnIFv3CeqP07pF8Fcl-265">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-267" value="主动向leader发起socket连接" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-266">
          <mxGeometry x="-0.2287" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-262" value="QuorumServer leaderServer = findLeader();" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1345" y="1690" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-269" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-265" target="losnIFv3CeqP07pF8Fcl-268">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-270" value="注册自己到leader" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-269">
          <mxGeometry x="-0.3378" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-265" value="connectToLeader(leaderServer.addr, leaderServer.hostname);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1345" y="1790" width="200" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-272" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-268" target="losnIFv3CeqP07pF8Fcl-271">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-273" value="同步leader数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-272">
          <mxGeometry x="-0.2172" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-268" value="long newEpochZxid = registerWithLeader(Leader.FOLLOWERINFO);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1317.5" y="1890" width="255" height="60" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-275" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=12;fontColor=#000000;strokeWidth=2;elbow=vertical;" edge="1" parent="1" source="losnIFv3CeqP07pF8Fcl-271" target="losnIFv3CeqP07pF8Fcl-274">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-276" value="while死循环接收leader同步的数据" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;fontColor=#000000;" vertex="1" connectable="0" parent="losnIFv3CeqP07pF8Fcl-275">
          <mxGeometry x="-0.3969" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-271" value="syncWithLeader(newEpochZxid);" style="rounded=0;whiteSpace=wrap;strokeWidth=2;fillColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1347.5" y="2030" width="195" height="40" as="geometry" />
        </mxCell>
        <mxCell id="losnIFv3CeqP07pF8Fcl-274" value="while (self.isRunning()) {&#xa;  readPacket(qp);" style="whiteSpace=wrap;rounded=0;strokeWidth=2;fillColor=#FFFFFF;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1363.75" y="2140" width="162.5" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
